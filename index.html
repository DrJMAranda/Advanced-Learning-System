<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEA-ALS‚Ñ¢</title>
    <style>
        /* Finalized CSS for Low Visual Burden and Structural Clarity */
        body { font-family: 'EB Garamond', sans-serif; background-color: #F8F0E3; color: #333; margin-top: 0; }
        .container { max-width: 1100px; margin: 5px auto 20px auto; }
        h2 { text-align: center; font-size: 1.1em; color: #3b82f6; margin-top: 5px !important; margin-bottom: 5px !important; }
        .table-container { overflow-x: auto; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); background-color: white; }
        /* Grid Contrast and Top Alignment */
        th, td { border: 1px solid #6b7280; padding: 6px 4px; text-align: center; vertical-align: top; font-size: 0.85em; }
        th { background-color: #3b82f6; color: white; font-weight: bold; }
        
        /* Final Differentiated State Definitions */
        .module-cell { cursor: pointer; background-color: #FFFFFF; transition: background-color 0.3s; } 
        .module-cell.state-0 { background-color: #d1d5db; color: #6b7280; cursor: default; } 
        .module-cell:hover:not(.state-0):not(.state-1) { background-color: #e0f2f1; }
        /* FLAG: MASTERY STATE DEFINITION --- Color set aside (Functionality over Display) */
        .state-1 { 
            background-color: #FFFFFF !important; /* Forces white background, preserves logical flag */
            color: #333; 
            font-weight: normal; 
        } 
        .locked { cursor: not-allowed; background-color: #ef4444 !important; color: white; animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        .context-cell { background-color: #e0f2f1; font-style: italic; font-size: 0.9em; cursor: default; }
    </style>
    </head>
<body>
    <div class="container">
        <h2>SEA-ALS‚Ñ¢ Curriculum Matrix</h2>
        
        <div class="table-container">
            <table id="performanceTable">
                <thead>
                    <tr>
                        <th rowspan="2">Unit</th>
                        <th rowspan="2">Arit_Ref</th>     
                        <th colspan="6">Lang</th>
                        <th rowspan="2">Voc</th>
                        <th rowspan="2">Lit</th>
                        <th rowspan="2">Exe</th>
                        <th rowspan="2">Mus</th>
                        <th rowspan="2">Civ</th>
                    </tr>
                    <tr>
                        <th>Eng</th>
                        <th>Spa</th>
                        <th>Por</th>
                        <th>Tag</th>
                        <th>Fre</th>
                        <th>Dut</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-row-id="1">
                        <td>U1S1</td>
                        <td class="module-cell state-1" data-subj="Arit_Ref"></td>
                        <td class="module-cell state-1" data-subj="Eng"></td>
                        <td class="module-cell" data-subj="Spa"></td>
                        <td class="module-cell state-0" data-subj="Por"></td>
                        <td class="module-cell state-0" data-subj="Tag"></td>
                        <td class="module-cell state-0" data-subj="Fre"></td>
                        <td class="module-cell state-0" data-subj="Gua"></td>
                        <td class="module-cell state-1" data-subj="Vocb" data-seq="1"></td>
                        <td class="module-cell state-1" data-subj="Lit">Justicia</td>
                        <td class="module-cell misc-cell" data-subj="Ejer"></td>
                        <td class="module-cell misc-cell" data-subj="Mus"></td>
                        <td class="module-cell misc-cell" data-subj="Civ"></td>
                    </tr>
                    <tr data-row-id="2">
                        <td>U1S2</td>
                        <td class="module-cell" data-subj="Arit_Ref"></td> 
                        <td class="module-cell" data-subj="Eng"></td>
                        <td class="module-cell" data-subj="Spa"></td>
                        <td class="module-cell state-0" data-subj="Por"></td>
                        <td class="module-cell state-0" data-subj="Tag"></td>
                        <td class="module-cell state-0" data-subj="Fre"></td>
                        <td class="module-cell state-0" data-subj="Gua"></td>
                        <td class="module-cell" data-subj="Vocb" data-seq="2"></td>
                        <td class="module-cell" data-subj="Lit">Constancia</td> 
                        <td class="module-cell misc-cell" data-subj="Ejer"></td>
                        <td class="module-cell misc-cell" data-subj="Mus"></td>
                        <td class="module-cell misc-cell" data-subj="Civ"></td>
                    </tr>
                    <tr data-row-id="3"><td>U1S3</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="3"></td><td class="module-cell" data-subj="Lit">Responsabilidad</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="4"><td>U2</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="4"></td><td class="module-cell" data-subj="Lit">Libertad</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="5"><td>U3</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="5"></td><td class="module-cell" data-subj="Lit">Verdad</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="6"><td>U4</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="6"></td><td class="module-cell" data-subj="Lit">Honestidad</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="7"><td>U5</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="7"></td><td class="module-cell" data-subj="Lit">Resp. Personal</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="8"><td>U6</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="8"></td><td class="module-cell" data-subj="Lit">Servicio Com.</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="9"><td>U7</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="9"></td><td class="module-cell" data-subj="Lit">Empat√≠a</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="10"><td>U8</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="10"></td><td class="module-cell" data-subj="Lit">Cooperaci√≥n</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="11"><td>U9</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="11"></td><td class="module-cell" data-subj="Lit">Persistencia</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="12"><td>U10</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="12"></td><td class="module-cell" data-subj="Lit">Autodisciplina</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="13"><td>U11</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="13"></td><td class="module-cell" data-subj="Lit">Humildad</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="14"><td>U12</td><td class="module-cell" data-subj="Arit_Ref"></td><td class="module-cell" data-subj="Eng"></td><td class="module-cell" data-subj="Spa"></td><td class="module-cell state-0" data-subj="Por"></td><td class="module-cell state-0" data-subj="Tag"></td><td class="module-cell state-0" data-subj="Fre"></td><td class="module-cell state-0" data-subj="Gua"></td><td class="module-cell" data-subj="Vocb" data-seq="14"></td><td class="module-cell" data-subj="Lit">Paciencia</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                    <tr data-row-id="15"><td>U13</td><td class="module-cell" data-subj="Arit_Ref" data-is-final="true"></td><td class="module-cell" data-subj="Eng" data-is-final="true"></td><td class="module-cell" data-subj="Spa" data-is-final="true"></td><td class="module-cell state-0" data-subj="Por" data-is-final="true"></td><td class="module-cell state-0" data-subj="Tag" data-is-final="true"></td><td class="module-cell state-0" data-subj="Fre" data-is-final="true"></td><td class="module-cell state-0" data-subj="Gua" data-is-final="true"></td><td class="module-cell" data-subj="Vocb" data-seq="15"></td><td class="module-cell" data-subj="Lit" data-is-final="true">Conciencia</td><td class="module-cell misc-cell" data-subj="Ejer"></td><td class="module-cell misc-cell" data-subj="Mus"></td><td class="module-cell misc-cell" data-subj="Civ"></td></tr>
                </tbody>
            </table>
        </div>
        <div id="iconContainer" style="text-align: center; margin-top: 15px; font-size: 2em; color: #1e40af; min-height: 40px;"></div>
        <div id="statusMessage" style="text-align: center; margin-top: 10px; color: #3b82f6;">El √≠ndice se est√° inicializando...</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const table = document.getElementById('performanceTable');
            const statusDiv = document.getElementById('statusMessage');
            const iconContainer = document.getElementById('iconContainer');  
            
            function getEstado(id) {
                const cell = document.getElementById(id);
                if (!cell) return false;
                return cell.classList.contains('state-1');
            }

            // X MARKS THE SPOT: LAUNCH FILE PATH GENERATOR - START
            function launchModule(rowId, subjId, cell) {
                // NOTE: This URL must be replaced with your SECURE SIGNED URL ENDPOINT in the future.
                const BASE_URL_STORAGE = "https://storage.googleapis.com/noenbalde/"; 
                
                const BASE_FOLDERS = {
                    'Lit': 'Curriculum/Language/Literature/',
                    'Vocb': 'Curriculum/Language/Vocabulary/',
                    'Ejer': 'Curriculum/Wellness/Exercises/',
                    'Mus': 'Curriculum/Wellness/Music/',
                    'Civ': 'Curriculum/Civics/', 
                    'Eng': 'Curriculum/Mathematics/Arithmetic/',
                    'Spa': 'Curriculum/Mathematics/Arithmetic/',
                    'Arit_Ref': 'Curriculum/Mathematics/Arithmetic/',
                };

                const folderPath = BASE_FOLDERS[subjId] || 'Curriculum/';
                let fileCode = '';
                let rowTitleCell = document.querySelector(`tr[data-row-id="${rowId}"] > td:first-child`);
                let rowTitle = rowTitleCell ? rowTitleCell.textContent : '';

                let simpleID = `${rowTitle}_${subjId.toUpperCase()}`; // Simple ID for debugging

                let langCode = subjId.toUpperCase().substring(0, 3);
                
                // üö© 1:1 LAUNCH CODE MAPPING START
                if (['Eng', 'Spa', 'Por', 'Tag', 'Fre', 'Dut'].includes(subjId)) {
                    if (subjId === 'Spa') {
                        langCode = 'ESP'; 
                    } else if (subjId === 'Eng') {
                        langCode = 'ENG'; 
                    }
                    fileCode = `AP1${rowTitle}${langCode}`; 
                } else if (subjId === 'Vocb') {
                    const seq = cell.dataset.seq;
                    fileCode = `LV${seq}`;
                } else if (subjId === 'Lit') {
                    fileCode = cell.textContent.split(' ')[0]; 
                } else if (subjId === 'Arit_Ref') {
                    fileCode = rowTitle; 
                } else if (['Ejer', 'Mus'].includes(subjId)) {
                    const seq = document.querySelector(`tr[data-row-id="${rowId}"] [data-subj="Vocb"]`).dataset.seq;
                    fileCode = `${subjId.toUpperCase().substring(0, 4)}${seq}`; 
                } else if (subjId === 'Civ') {
                    fileCode = `CIV_${rowTitle}`; 
                }
                // üö© 1:1 LAUNCH CODE MAPPING END

                const filePath = `${BASE_URL_STORAGE}${folderPath}${fileCode}.mp4`;

                window.open(filePath, '_blank'); 

                // ASYNCHRONOUS STATE STEP 1: Set PENDING flag on the cell after launch.
                cell.setAttribute('data-pending-rectification', 'true');
                statusDiv.textContent = `üöÄ Lanzamiento Iniciado: Hol√≥n ${cell.id} evocado. Haga clic otra vez para confirmar la Rectificaci√≥n (Absorci√≥n).`;
            }
            // X MARKS THE SPOT: LAUNCH FILE PATH GENERATOR - END

            // X MARKS THE SPOT: PREREQ GATE - START GUARDIAN LOGIC
            function toggleModuleState(cell) {
                const rowId = parseInt(cell.parentElement.dataset.rowId);
                const subjId = cell.dataset.subj;
                const cellId = cell.id;

                // üõë QPR CODE: FULL LAUNCH BYPASS FLAG (Enables Launch Functionality Now)
                // This entire function is now simplified to Click -> Launch -> Flag Mastered
                
                if (cell.classList.contains('state-0')) {
                     statusDiv.textContent = `üö´ Hol√≥n ${cellId}: Contenido Ausente (Gris). No hay reacci√≥n al clic.`;
                     return;
                }
                
                launchModule(rowId, subjId, cell);
                
                // Immediately sets the mastery flag for next launches
                cell.classList.add('state-1'); 
                statusDiv.textContent = `üöÄ Launch Override: Hol√≥n ${cellId} evocado. Functionality Enabled.`;
                return;
                
                // The previous complex logic and confirmation checks are now bypassed.
            }
            // X MARKS THE SPOT: PREREQ GATE - END GUARDIAN LOGIC


            // X MARKS THE SPOT: START INITIALIZATION & TD JUNGLE TAMER
            table.querySelectorAll('tbody tr').forEach(row => {
                const rowId = parseInt(row.dataset.rowId);
                let rowTitle = row.querySelector('td:first-child').textContent; 

                // üö© QPR CODE: TARGETED MODULE ACTIVATION (Overrides Prerequisites)
                // This activates Arit_Ref, Vocb, and Lit for all rows > 1 (U1S2 through U13).
                if (rowId > 1) { 
                    row.querySelectorAll('.module-cell').forEach(cell => {
                        const subjId = cell.dataset.subj;
                        
                        // Targeted activation for Arithmetic, Vocab, and Literature only.
                        if (['Arit_Ref', 'Vocb', 'Lit'].includes(subjId)) {
                            cell.classList.add('state-1');
                        }
                    });
                }
                // END QPR CODE

                row.querySelectorAll('.module-cell, .context-cell').forEach(cell => {
                    const subjId = cell.dataset.subj;
                    
                    // 1. Calculate the complex Semantic GUID for system logic (C1S01-ENG)
                    let unitSequence = rowTitle.replace(/[^\d]/g, ''); 
                    if (subjId === 'Lit' || subjId === 'Vocb') { 
                        unitSequence = cell.dataset.seq;
                    }
                    const uniqueModuleLabel = `C1S${unitSequence.padStart(2, '0')}-${subjId.toUpperCase()}`;
                    
                    // 2. Create the simple, readable 'Braille' label for display (U1S1_ENG)
                    const simpleID = `${rowTitle}_${subjId.toUpperCase()}`; 

                    // 3. Assign the robust GUID to the HTML ID attribute for the system
                    cell.id = uniqueModuleLabel;                       
                    
                    // 4. Set the VISIBLE content to the simple 'Braille' ID
                    if (!cell.classList.contains('context-cell')) {
                        cell.textContent = simpleID; 
                    }
                    
                    // 5. Attach the click listener (Functionality)
                    if (cell.classList.contains('module-cell') || cell.classList.contains('context-cell')) {
                        cell.addEventListener('click', () => toggleModuleState(cell));
                    }
                });
            });
            statusDiv.textContent = "El √≠ndice se ha poblado y est√° gobernando. Haga clic en una celda blanca para iniciar la rectificaci√≥n.";
            // X MARKS THE SPOT: END INITIALIZATION & TD JUNGLE TAMER
        });
    </script>
    </body> 
</html>
