<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Learning System</title> 
    
    <style>
        /* EB Garamond Font Integration */
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap'); 

        /* CSS Variables and Mixins */
        :root {
            --color-lighthouse: #f4f4f4;
            --color-stealth: #d3d3d3;  
            --color-accent-active: #ffdd88;
            --color-control: #444; 
            --bevel-shadow-light: rgba(255, 255, 255, 0.7);  
            --bevel-shadow-dark: rgba(0, 0, 0, 0.3);
            /* New LPS-specific color for exercise display area (KPS Display) */
            --color-lps-kps: #EFEFEF; 
        }
        .beveled-frame {  
            box-shadow: inset 1px 1px 3px var(--bevel-shadow-light), inset -1px -1px 3px var(--bevel-shadow-dark);  
            border: 1px solid var(--color-stealth);  
        }

        /* Base Styles and Layout */
        body {  
            margin: 0;  
            font-family: 'EB Garamond', serif;
            height: 100vh;
            display: flex;  
            background: var(--color-lighthouse);  
            color: black;
            overflow: hidden;  
        }

        /* Left Menu - Fixed and Controlled (ONETH Fix Applied) */
        #left-menu {  
            width: 225px;  
            background: var(--color-lighthouse);
            color: black;
            padding: 10px;  
            flex-shrink: 0;  
            height: 100vh; 
            position: relative; 
            padding-bottom: 70px; 
            /* CRITICAL FIX: Forces menu to scroll, preserving main layout stability */
            overflow-y: scroll; 
        }
        
        /* Left Menu Content Styles */
        #credits { text-align: center; }
        #menu-list-container { margin-top: 20px; text-align: left; padding: 5px; border: 1px dashed #0070C0; }
        #menu-list-content { font-size: 9pt; line-height: 1.3; font-weight: 400; color: black; white-space: pre-line; }

        /* Student ID/Descriptor Footer Box */
        #student-id-box {
            position: absolute;
            bottom: 30px; 
            left: 0;
            width: 100%;
            padding: 5px 10px;
            box-sizing: border-box;
            background: #fff; 
            border-top: 1px solid #ccc;
            font-family: 'Roboto Mono', monospace;
            font-size: 8pt;
            color: #333;
            line-height: 1.3;
            z-index: 99;
        }

        /* Fixed Date Stamp Footer */
        #date-stamp-tn-fixed {
            position: absolute; 
            bottom: 0px;        
            left: 0px;         
            padding: 5px 10px;  
            font-size: 7pt;     
            color: #555;        
            font-family: monospace; 
            z-index: 100;
            background: var(--color-lighthouse); 
            width: 100%; 
            box-sizing: border-box; 
            text-align: left;
        }

        /* Main Content Structure */
        #content-wrapper { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        #main-content { 
            flex-grow: 1; 
            padding: 20px; 
            background: var(--color-lighthouse); 
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center; 
            justify-content: flex-start; 
        }

        /* Icon Bar - Horizontal Scroll/Header (STABLE) */
        #scrolling-icon-bar {
            width: 100%;
            display: flex; 
            /* CRITICAL FIX: Must prevent wrapping onto new lines */
            flex-wrap: nowrap; 
            gap: 10px;
            padding: 10px;
            /* CRITICAL: Must allow horizontal scrolling when content exceeds width */
            overflow-x: auto; 
            flex-shrink: 0; 
            background: var(--color-stealth);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 80px; 
        }
        .icon-button {
            flex-shrink: 0; 
            width: 100px;
            text-align: center;
            border: 1px solid #999;
            background: #fff;
            padding: 5px;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8em;
        }
        .icon-button img {
            width: 100%; 
            /* ULTIMATE ONETH FIX: Prevents transient image/video sizing glitches */
            max-width: 100%; 
            height: auto;
            display: block;
        }
        .icon-title {
            display: block;
            margin-top: 5px;
        }


        /* The overall LPS Monitor/Control/Exercise Layout (Permanent) */
        #lps-monitor-simulacrum { 
            width: 90%; 
            max-width: 1000px;
            display: flex; 
            flex-direction: column;
            align-items: center;
        }

        /* LPS Header Strip for Title */
        #lps-header-strip { 
            width: 100%;
            background: var(--color-control);
            color: var(--color-lighthouse);
            padding: 5px 10px;
            box-sizing: border-box;
            font-family: 'Roboto Mono', monospace;
            font-size: 10pt;
            text-align: left;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        /* 1. Video Monitor (16:9 Aspect Ratio) */
        #video-display-monitor { 
            width: 100%; 
            padding-bottom: 56.25%; 
            position: relative; 
            background-color: black; 
            border: 2px solid #555; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5); 
        }
        #video-player-secure { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            user-select: none;
            -webkit-user-select: none;
            cursor: default;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: black; 
            color: white;
            transition: background-color 0.3s;
            /* CRITICAL: Background properties for Bucolic Panorama (will be GCS link in final deployment) */
            background-image: url('https://storage.googleapis.com/noenbalde/Backgrounds/Bucolic-Panorama-Placeholder.jpg');
            background-size: cover;
            background-position: center;
            /* Simple overlay for text visibility */
            position: relative; 
        }

        /* Style for the text overlay on the panorama */
        #initial-message-overlay {
            background-color: rgba(0, 0, 0, 0.4); /* Dark semi-transparent overlay */
            padding: 20px 40px;
            border-radius: 5px;
        }
        
        /* New style for when the LPS is showing KPS content */
        #video-player-secure.kps-mode { 
             background-color: var(--color-lps-kps); 
             color: black;
             background-image: none; /* Remove panorama image in KPS mode */
             overflow-y: auto; 
             padding: 20px;
             box-sizing: border-box;
        }
        
        #return-to-cards-btn-embedded { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            z-index: 10; 
            background: rgba(51, 51, 51, 0.7); 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            font-size: 1.2em; 
            cursor: pointer; 
            line-height: 1; 
            border-radius: 3px; 
        }

        /* 2. Horizontal Control Bar (The Better GUI) */
        #lps-control-bar { 
            width: 100%;
            background: var(--color-control);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between; 
            align-items: center;
            gap: 15px;
            border: 1px solid #777;
            box-sizing: border-box;
            font-family: 'Roboto Mono', monospace;
            color: white;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }
        #lps-control-bar button {
            background: #fff;
            border: 1px solid #333;
            padding: 5px 10px;
            font-size: 1.1em;
            cursor: pointer;
            line-height: 1;
            min-width: 60px;
            font-family: inherit;
        }
        #lps-control-bar button:hover { background: var(--color-accent-active); }

        /* 3. Knowledge Practice System Area (Collapsible) */
        #knowledge-practice-system { 
            width: 100%;
            min-height: 250px; 
            background: #fff;
            border: 1px dashed #0070C0; 
            margin-top: 20px;
            padding: 15px;
            box-sizing: border-box;
            text-align: center;
            color: #555;
            font-size: 1.1em;
            transition: all 0.3s ease-in-out; 
            overflow: hidden;
        }
        /* CRITICAL FIX: Class for collapsing the KPS area */
        #knowledge-practice-system.inactive {
            min-height: 0;
            height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            border: none;
            opacity: 0;
        }

        /* Hidden MUSAC Player container */
        #musac-player {
            display: none; 
        }
    </style>
</head>
<body>
    
    <nav id="left-menu" class="beveled-frame">
        
        <div id="credits">
            <h2>Welcome to the<br>Advanced Learning System</h2>
            <h4>Powered by ARAGEM</h4>
        </div>
        <div id="credits">
            <h5>Email: jmaf.phd@Gmail.com</h5>
        </div>
        
        <div id="menu-list-container">
            <div id="menu-list-content">
                <div id="numeral-header" style="font-weight: bold; margin-bottom: 5px; cursor: pointer; color: #0070C0;">A. Arithmetic (Click to Toggle)</div> 
                <div id="numeral-content" style="padding-left: 10px; display: block;">
                    01 Numerals to |Nine|
                    02 Numerals to |Ninety-Nine|
                    03 Nuerals to |Decillions|
                    04 Addition Principles
                    05 Addition Fundamentals
                    06 Addition Elements and Principles
                    07 Parity, Sets, and Composites
                    08 Opposite Signs and Subtraction
                    09 Multiplication
                    10 Division, Partition, and Quotition
                    11 Fractions
                    12 Chronos
                    13 Shapes and Sundry Things
                    
                    B. G2 ~ 8th Grade Arithmetic
                    C. G3 ~ Albebra 1
                    D. G4 ~ Algebra 2
                    E. G5 ~ Geometry
                    F. G6 ~ Trigonometry
                    G. G7 ~ Statistics and Probability
                    H. G8 ~ Calculus 1
                </div>
                <div style="margin-top: 5px; border-top: 1px dashed #ccc; padding-top: 10px;">

                </div>
            </div>
        </div>

        <div id="outline-container" style="margin-top: 50px;">
            <p id="loading-placeholder" style="text-align: center; font-style: italic; font-weight: 700;">
            </p>
            <ul id="outline-list">
                </ul>
        </div>
        
        <div id="student-id-box">
             **Student ID:** [Loading...]<br>
             **Descriptors:** [None Active]
        </div>

        <div id="date-stamp-tn-fixed"></div>

    </nav>

    <div id="content-wrapper">
        <header id="scrolling-icon-bar" class="beveled-frame">
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/AP1U1S1%20Meet%20The%20Digits.mp4', 'A1P1U1S1: The Journey Begins...', 'A1P1U1S1')">
                <img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/The%20Journey%20Begins.jpg" alt="A1P1U1S1">
                <span class="icon-title">A1P1U1S1</span>
            </button>
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/04%20AP1U1S2%20Counting%20through%20Four.mp4', 'A1P1U1S2: Mr. Zero, The First Something!', 'A1P1U1S2')">
                <img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/Mr.%20Zero%2C%20The%20First%20Something.jpg" alt="A1P1U1S2">
                <span class="icon-title">A1P1U1S2</span>
            </button>
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/AP1U1S3T5-9%20250928%202033%20TN.mp4', 'A1P1U1S3: The Numeral Family', 'A1P1U1S3')">
                <img src="https://storage.googleapis.com/noenbalde/Giddyap/AP1U1S3T5-9%20250928%202023.mp4" alt="A1P1U1S3">
                <span class="icon-title">A1P1U1S3</span>
            </button>
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Videos/Video%20Cien%20Diez%20Uno.mp4', 'Decillones: Counting Concepts', 'DECIL')">
                <img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/Decillones.jpg" alt="Decillones">
                <span class="icon-title">Decillions</span>
            </button>           
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/04%20Minnie's%20Pennie%20Song%20~English.mp4', 'Penny Song', 'Money')">
                <img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/Penny%20Song.jpg" alt=" ">
                <span class="icon-title">Penny Song</span>
            </button>
             <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Videos/Video%20Cien%20Diez%20Uno.mp4', 'A1P1U1S4: The Zero\'s Journey', 'A1P1U1S4')">
                <img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/The%20Zero's%20Journey.jpg" alt="A1P1U1S4">
                <span class="icon-title">A1P1U1S4</span>
            </button>
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Videos/Video%20Cien%20Diez%20Uno.mp4', 'A1P1U2: Classification Gates', 'A1P1U2')">
                <img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/Classification%20Gates.jpg" alt="A1P1U2">
                <span class="icon-title">A1P1U2</span>
            </button>
        </header>

        <div id="content-wrapper">
             <div id="main-flex-container">
                 <section id="main-content">
                     
                    <div id="lps-monitor-simulacrum">

                        <div id="lps-header-strip">Select a Unit</div>
                        
                        <div id="video-display-monitor">
                            <div id="video-player-secure">
                                </div>
                            <button id="return-to-cards-btn-embedded" onclick="closeVideo()" style="display: none;">&larr;</button>
                        </div>

                        <div id="lps-control-bar">
                            <div style="display: flex; gap: 10px;">
                                 <button>&lt;&lt;&lt;</button>
                                 <button>&lt;&lt;</button>
                                 <button id="play-pause-btn">❚❚ / ▶️</button>
                                 <button>&gt;&gt;</button>
                                 <button>&gt;&gt;&gt;</button>
                                 <button onclick="closeVideo()">X</button>
                            </div>
                            <button id="toggle-exercises-btn" onclick="toggleKPSArea(true)">⬇️ Hide KPS</button>
                        </div>

                        <div id="knowledge-practice-system">
                             **Knowledge Practice System (KPS)** / *Pertinent Descriptors*
                             <br><br>
                             This lower area is for interactive exercises. It collapses to allow the main LPS screen to time-share its real estate for KPS content (like a full-screen PDF).
                        </div>

                    </div>
                    
                    <div id="musac-player">
                        </div>
                    
                 </section>
             </div>
        </div>
    </div>
    
    <script>
        // --- JAVASCRIPT: CORE FUNCTIONS ---

        const lpsSimulacrum = document.getElementById('lps-monitor-simulacrum');
        const videoPlayerSecure = document.getElementById('video-player-secure');
        const lpsHeaderStrip = document.getElementById('lps-header-strip');
        const returnBtn = document.getElementById('return-to-cards-btn-embedded');
        const numeralHeader = document.getElementById('numeral-header');
        const numeralContent = document.getElementById('numeral-content');
        const musacPlayer = document.getElementById('musac-player');
        const knowledgePracticeSystem = document.getElementById('knowledge-practice-system');
        const toggleExercisesBtn = document.getElementById('toggle-exercises-btn');
        
        // ** Permanent Initial State Content (Bucolic Panorama with Overlay) **
        const initialContentHTML = `
            <div id="initial-message-overlay">
                <h2 style="color: white; padding-top: 10px; margin-top: 0; font-size: 2em;">Select a Unit or Section from The Star Chart.</h2>
                <p style="color: white; font-size: 1.1em;">The Force will guide your learning journey.</p>
            </div>
        `;
        
        // ** Permanent KPS Content Placeholder (White Screen for Reassignment) **
        const reassignedKPSHTML = `
            <h2 style="font-size: 1.8em;">LPS Time-Sharing: KPS Maximize Mode (PDF/Exercise)</h2>
            <p style="font-size: 1.1em;">The lower **Knowledge Practice System (KPS)** area is collapsed, allowing the **Learning Presentation System (LPS)** screen to take over the real estate for maximized vertical content presentation.</p>
            <div style="height: 250px; border: 1px dashed #333; margin: 20px; padding: 10px; width: 90%;">[Content of KPS/PDF Goes Here]</div>
        `;


        // Function to control MUSAC activation/deactivation
        function toggleMusac(active) {
            // NOTE: In the live GCS deployment, we will control the musac-audio element here (play/pause)
            if (active) {
                console.log("MUSAC Activated: Playing alpha-wave music (Clair de Lune or Cavalleria Rusticana).");
                musacPlayer.style.display = 'block'; 
            } else {
                console.log("MUSAC Deactivated: Monitor is active.");
                musacPlayer.style.display = 'none';
            }
        }
        
        // Function to control the KPS area collapse and LPS reassignment
        function toggleKPSArea(manualToggle = false) {
            const isInactive = knowledgePracticeSystem.classList.contains('inactive');
            
            if (isInactive) {
                // Restore KPS Area (Minimize LPS role)
                knowledgePracticeSystem.classList.remove('inactive');
                toggleExercisesBtn.textContent = '⬇️ Hide KPS';
                videoPlayerSecure.classList.remove('kps-mode');
                // IMPORTANT: Restore LPS display to idle message (with panorama/MUSAC)
                if (manualToggle) showInitialMessage(false);
                console.log("KPS Area Restored (LPS Reassigned Role Ended)");
            } else {
                // Collapse KPS Area (Maximize LPS role for KPS content)
                knowledgePracticeSystem.classList.add('inactive');
                toggleExercisesBtn.textContent = '⬆️ Show KPS (Full View)';
                videoPlayerSecure.classList.add('kps-mode');
                // IMPORTANT: Change LPS display to KPS content
                videoPlayerSecure.innerHTML = reassignedKPSHTML; 
                toggleMusac(true); // MUSAC can remain active in this state
                console.log("KPS Area Collapsed (LPS Reassigned to Full-Screen KPS Presenter)");
            }
        }


        // The core function: plays a module or displays info (NOW FUNCTIONAL)
        function playModule(videoSource, moduleTitle, idnKey) {
            
            if (!videoSource) {
                 console.error("Error: No video source provided for icon.");
                 return;
            }
            
            // 1. Deactivate MUSAC (Video is about to play)
            toggleMusac(false);
            // 2. Ensure KPS is visible (default state for video playback)
            knowledgePracticeSystem.classList.remove('inactive');
            toggleExercisesBtn.textContent = '⬇️ Hide KPS';
            videoPlayerSecure.classList.remove('kps-mode'); 

            // 3. Show controls
            returnBtn.style.display = 'block';

            // 4. Update LPS Header Title
            lpsHeaderStrip.textContent = `Now Playing: ${moduleTitle} (${idnKey})`;

            // 5. Load Functional Content (Video Test) - ULTIMATE ONETH FIX
            videoPlayerSecure.innerHTML = `
                <video controls autoplay style="width: 100%; height: 100%; object-fit: cover;">
                    <source src="${videoSource}" type="video/mp4">
                    Your browser does not support the video tag. GCS Link Test: ${videoSource}
                </video>
            `;
        }

        // Safe-State Recovery Function (LPS Idle)
        function showInitialMessage(forceReassign = true) {
            
            // Only reset if we are not in the collapsed/reassigned state OR if we are forced to
            if (forceReassign || !knowledgePracticeSystem.classList.contains('inactive')) {
                // 1. Activate MUSAC (Monitor is idle)
                toggleMusac(true);
                // 2. Ensure KPS is visible (default state)
                knowledgePracticeSystem.classList.remove('inactive');
                toggleExercisesBtn.textContent = '⬇️ Hide KPS';
                videoPlayerSecure.classList.remove('kps-mode'); 

                // 3. Hide video controls
                returnBtn.style.display = 'none';

                // 4. Reset LPS Header Title
                lpsHeaderStrip.textContent = `Select a Unit to Begin`;

                // 5. Display Initial Content in the permanent monitor (Bucolic Panorama)
                videoPlayerSecure.innerHTML = initialContentHTML;
            }
        }

        function closeVideo() { showInitialMessage(); }

        // **JAVASCRIPT: Date Stamp Function (TN Time, Minutes Only)**
        function updateDateStamp() {
            const now = new Date();
            const options = { 
                year: 'numeric', 
                month: '2-digit', 
                day: '2-digit', 
                hour: '2-digit', 
                minute: '2-digit', 
                timeZone: 'America/Chicago', 
                hour12: false,
                timeZoneName: 'short'
            };
            const dateString = now.toLocaleString('en-US', options);
            document.getElementById('date-stamp-tn-fixed').textContent = `TN Time: ${dateString}`;
        }
        
        // Left Menu: Collapsible Content Logic
        function toggleNumerals() {
             if (numeralContent.style.display === 'none') {
                 numeralContent.style.display = 'block';
             } else {
                 numeralContent.style.display = 'none';
             }
        }


        // --- EXECUTION ---
        
        document.addEventListener('DOMContentLoaded', () => {
            
            // Set initial state: The monitor is permanent, shows the initial message, and MUSAC is active.
            showInitialMessage();  
            
            // Activate Date Stamp
            updateDateStamp(); 
            setInterval(updateDateStamp, 60000); 

            // Activate Collapsible Menu
            numeralHeader.addEventListener('click', toggleNumerals);

            // Mockup Student ID Load
            document.getElementById('student-id-box').innerHTML = `
                 **Student ID:** 900213<br>
                 **Descriptors:** [ALGEBRAIC: C, NUMERACY: D]
            `;
        });
    </script>
</body>
</html>
