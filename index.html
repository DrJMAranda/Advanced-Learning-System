<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SEA~ALS - Core System</title>
        <style>
            /* VROOGLY: GLOBAL ORDER AND STRUCTURAL MAP */
            body { margin: 0; padding: 0; background-color: #000; font-size: 16px; color: #00ff00; }
            .outer-flexbox { display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; width: 100vw; overflow: hidden; }

            /* VROOGLY: INNER GRID (Minimal Vertical Stack) */
            .inner-grid-container {
                display: grid;
                grid-template-columns: repeat(5, 1fr); 
                grid-template-rows: 0.2fr 3.6fr 0.2fr; 
                width: 100%; max-width: 1200px; height: 100vh; 
            }

            /* VROOGLY: TTM & STATUS BAR (Consolidated into the top row) */
            .status-header {
                grid-column: 1 / span 5; grid-row: 1; 
                display: flex; justify-content: space-between; align-items: center;
                padding: 5px 10px; font-family: 'Courier New', monospace;
            }
            .ttm-output { white-space: nowrap; flex-shrink: 0; color: #00ff00; }

            /* VROOGLY: STRUCTURAL INTEGRITY FIX - 20ch WIDTH COMPLIANCE (APPLIED TO ALL MONOSPACE OUTPUTS) */
            .monospaced-compliance {
                font-family: 'EB Garamond Mono', 'Courier New', monospace;
                font-size: 14pt; /* Enforce 14pt standard */
                width: 20ch; /* Enforce 20-character width */
                max-width: 20ch;
                min-width: 20ch;
                overflow: hidden;
                white-space: nowrap;
                text-align: center;
            }

            /* VROOGLY: Large Text/Image Holon Definitions (The content shown in the screenshot) */
            .story-content-area {
                display: flex;
                flex-direction: row;
                padding: 20px;
                /* Note: This is a placeholder class, assuming your large text/image content is wrapped by it */
            }

            /* VROOGLY: High-Density Text Bar Definition (Hidden by default) */
            .minimal-text-bar {
                position: absolute;
                bottom: 0; 
                left: 50%;
                transform: translateX(-50%);
                padding: 4px 0;
                background-color: #000;
                z-index: 100;
                /* Default state: only visible when triggered by media query */
            }
            
            /* VROOGLY: THE CENTRAL HOLON (VidMon container) */
            .viewmon-container {
                grid-column: 1 / span 5; grid-row: 2; 
                background-color: #000;
                display: flex; flex-direction: column;
                aspect-ratio: 16 / 9;
                width: 90%; margin: 0 auto; position: relative;
                border: 5px solid #333; border-radius: 8px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.8); 
            }
            .vidmon-display {
                flex-grow: 1; background-color: black; position: relative;
            }
            .vidmon-display video { width: 100%; height: 100%; object-fit: contain; }
            .vidmon-display::after {
                content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                background: repeating-linear-gradient(#00000000, #00000000 1px, #0a0a0a33 1px, #0a0a0a33 2px);
                opacity: 0.1; pointer-events: none; 
            }
            
            /* VROOGLY: THE ACTION HOLON (CONTROLS ROW) */
            .controls-row {
                order: -1; 
                display: flex; justify-content: space-between; align-items: center;
                padding: 5px 5px; width: 100%;
                gap: 10px; 
                background-color: #333; 
            }
            .control-btn {
                width: 67px; height: 67px; display: flex; justify-content: center; align-items: center;
                background-color: #555; color: #fff; border: 2px solid #888; border-radius: 4px;
                font-weight: bold; cursor: pointer; box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
                font-size: 28px; 
            }

            /* ----------------------------------------------------------------- */
            /* VROOGLY: STRUCTURAL TRANSFORMATION - MOBILE BREAKPOINT ENFORCEMENT */
            /* Enforce small-screen structural economy (achieve 80% administrative economy) */
            /* ----------------------------------------------------------------- */
            @media (max-width: 600px) {
                /* 1. STRUCTURAL ELIMINATION: Hide the large, chaotic elements */
                .story-content-area, .metadata-item.id-registro {
                    display: none !important;
                }
                
                /* 2. STRUCTURAL ACTIVATION: Activate the high-density text bar */
                #high-density-text-bar {
                    display: block !important;
                }

                /* 3. CONSOLIDATE STATUS: Ensure TTM output uses maximum width available */
                .ttm-output {
                    width: auto;
                    flex-grow: 1; /* Allow it to consume space next to action-status-zone */
                }
            }

        </style>
    </head>
    <body>
        
        <div class="outer-flexbox">
            <div class="inner-grid-container">
                
                <div class="status-header">
                    <div class="metadata-item id-registro">ID: G-1001 / REL: M-45</div>
                    <div class="ttm-output monospaced-compliance" id="ttm-output">L1: 00:00/05:00 PENDING | L2: ARIT 0 PUNT 0.00</div>
                    <div class="action-status-zone monospaced-compliance"><p id="feedback-message">AWAITING MEDIA METADATA</p></div>
                </div>

                <div class="viewmon-container">
                    
                    <div class="controls-row">
                        <button data-control="5" class="control-btn" title="Fast Forward/End">⏭</button>
                        <button data-control="2" class="control-btn" title="Restart/A">|◀</button>
                        <button data-control="3" class="control-btn" title="Rewind/B">⏪</button>
                        <button data-control="4" class="control-btn" title="Play/Acknowledge">▶</button>
                        <button data-control="1" class="control-btn" title="Exit/Eject">↩</button>
                    </div>

                    <div class="vidmon-display">
                        <video id="viewmon-video" controlsList="nodownload" disablepictureinpicture src="http://your.video.source/default.mp4" autoplay muted></video>
                        <div id="high-density-text-bar" class="monospaced-compliance minimal-text-bar" style="display: none;"></div> 
                    </div>
                </div>
                
                <div class="story-content-area">
                    <p>The Boy Who Cried Wolf...</p>
                    <img src="placeholder.jpg" alt="Boy and Sheep" />
                </div>
            </div>
        </div>
        
        <script>
            // --- JAVASCRIPT: THE INTELLIGENT ENTITY (IE) ---
            
            // 24. VROOGLY: DATA SCHEMA (GIT PENSUM - STRUCTURAL CONTRACT)
            const GIT_Module_Data = {
                video_url: "https://storage.googleapis.com/noenbalde/Curriculum/Language/Literature/LLAesop1.mp4",
                video_duration_sec: 192, 
                ttm_initial_status: "PENDING", 
                tasks: [
                    { id: 1, question: "What civic value did the boy first violate?", solution: "Truthfulness", input_map: '4', validation_type: 'boolean', trigger_time_sec: 35, progression_jump: 20 },
                    { id: 2, question: "Why did the villagers stop trusting the boy's cries?", solution: "Repetition", input_map: '2', validation_type: 'multiple_choice', trigger_time_sec: 75, progression_jump: 30 },
                    { id: 3, question: "When the wolf truly arrived, did the structural damage (the lie) matter?", solution: "Yes", input_map: '1', validation_type: 'boolean', trigger_time_sec: 130, progression_jump: 40 },
                    { id: 4, question: "The final moral is that habitual lying leads to a loss of:", solution: "Trust", input_map: '4', validation_type: 'boolean', trigger_time_sec: 170, progression_jump: 22 }
                ],
                image_flow_items: []
            };

            // 25. VROOGLY: GLOBAL STATE
            let state = {
                isQuizActive: false, 
                currentTaskIndex: 0,
                attemptsCount: 0,
                score: 0.0, 
                videoTimeFrozen: 0 
            };
            
            // VROOGLY: TIME FORMATTER
            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            // VROOGLY: CHALICE ACTIVATION LOGIC
            const triggerAcknowledgment = () => {
                const video = document.getElementById('viewmon-video');
                const currentTask = GIT_Module_Data.tasks[state.currentTaskIndex];

                state.isQuizActive = true;
                video.pause(); 
                
                document.getElementById('feedback-message').textContent = `CHALICE: ${currentTask.question}`;
            };

            // VROOGLY: RESOLVE THE CHALICE (Simulated answer handler)
            const simulateOverlayConfirm = (isCorrect) => {
                if (!state.isQuizActive) return;

                if (isCorrect) {
                    state.attemptsCount++;
                    state.score = 1.0; 
                    state.isQuizActive = false;
                    
                    document.querySelector('[data-control="4"]').disabled = false;
                    document.getElementById('feedback-message').textContent = "ACKNOWLEDGED. Ready to Advance (Key 4)";
                } else {
                    state.attemptsCount++;
                    document.getElementById('feedback-message').textContent = "ERROR: Try Again. Score 0.0";
                }
                syncSupportLayers();
            };
            
            // VROOGLY: STRUCTURAL INTEGRITY FIX - TIME BASE HARDENING 
            const calculateTimeMetrics = (video) => {
                // High-precision time in microseconds for N_R -> 0 certainty
                const current_time_us = Math.round(video.currentTime * 1000000);
                const duration_us = Math.round(video.duration * 1000000);
                
                const current_time_sec = video.currentTime;
                const duration_sec = video.duration;

                return {
                    currentTime: current_time_sec,
                    duration: duration_sec,
                    currentTime_us: current_time_us,
                    duration_us: duration_us
                };
            };

            // VROOGLY: TIME SYNCHRONIZATION LOGIC (The "Place and Time" Enforcer)
            const syncSupportLayers = () => {
                const video = document.getElementById('viewmon-video');
                const ttmOutput = document.getElementById('ttm-output');
                
                if (!video) return; 

                const metrics = calculateTimeMetrics(video);
                
                // VROOGLY: STRUCTURAL INTEGRATION - POPULATE HIGH-DENSITY TEXT BAR
                const textBar = document.getElementById('high-density-text-bar');
                const feedbackMessage = document.getElementById('feedback-message').textContent;
                
                if (textBar) {
                    // Display current status/message (max 20 characters)
                    textBar.textContent = feedbackMessage.substring(0, 20); 
                }

                const newTtmText = `L1: ${formatTime(metrics.currentTime)}/${formatTime(metrics.duration)} PENDING | L2: ARIT ${state.attemptsCount} PUNT ${state.score.toFixed(2)}`;
                ttmOutput.textContent = newTtmText;
                
                const currentTask = GIT_Module_Data.tasks[state.currentTaskIndex];

                if (currentTask && metrics.currentTime >= currentTask.trigger_time_sec && !state.isQuizActive) {
                    triggerAcknowledgment();
                }
            };
            
            // VROOGLY: THE DIGITAL ACTIVATION MAP
            const KEY_MAPPING = {
                'Digit1': '1', 'Digit2': '2', 'Digit3': '3', 'Digit4': '4', 
                'Escape': '5'
            };
            
            // VROOGLY: PROGRESSION LOGIC (Time-Efficient)
            const handleNextProgression = () => {
                const total = GIT_Module_Data.tasks.length;
                const video = document.getElementById('viewmon-video');

                if (state.currentTaskIndex < total) {
                    const currentTask = GIT_Module_Data.tasks[state.currentTaskIndex];
                    const jumpTime = currentTask.progression_jump || 0; 

                    video.currentTime = Math.min(video.currentTime + jumpTime, video.duration); 

                    state.currentTaskIndex++;
                    state.score = 0.0; 
                    
                    document.querySelector('[data-control="4"]').disabled = true; 
                    document.getElementById('feedback-message').textContent = `Task ${state.currentTaskIndex + 1} initiated.`;

                } else if (state.currentTaskIndex === total) {
                    document.getElementById('feedback-message').textContent = "MODULE COMPLETE. Structural Order Achieved.";
                    document.querySelector('[data-control="4"]').disabled = true; 
                    video.pause();
                }
            };
            
            // VROOGLY: CONTROL CLICK HANDLER (Action Holon Logic)
            const handleControlClick = (event) => {
                const controlNumber = event.currentTarget.dataset.control;
                const video = document.getElementById('viewmon-video');

                if (state.isQuizActive) { return; } 
                
                if (controlNumber === '4') { 
                    if (state.score === 1.0) {
                        handleNextProgression(); 
                    } else if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                } else if (controlNumber === '3') { 
                    video.currentTime = Math.max(0, video.currentTime - 10); 
                } 
            };

            // VROOGLY: THE KEYBOARD BINDING (Eliminate the Negative)
            const handleGlobalKeyPress = (event) => {
                const key = event.code;

                if (state.isQuizActive) {
                    // VROOGLY: Simulated answer inputs
                    if (key === 'Digit1') { 
                        simulateOverlayConfirm(true); 
                        event.preventDefault();
                    } else if (key === 'Digit2') { 
                        simulateOverlayConfirm(false); 
                        event.preventDefault();
                    }
                    return; 
                }
                
                const mappedControl = KEY_MAPPING[event.code];
                if (mappedControl) {
                    const targetButton = document.querySelector(`[data-control="${mappedControl}"]`);
                    if (targetButton && !targetButton.disabled) {
                        targetButton.click(); 
                        event.preventDefault(); 
                    }
                }
            };
            
            // VROOGLY: INITIALIZATION (Hardened Structural Wait)
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.control-btn').forEach(button => {
                    button.addEventListener('click', handleControlClick);
                });
                
                const playButton = document.querySelector('[data-control="4"]');
                playButton.disabled = true;
                
                document.addEventListener('keydown', handleGlobalKeyPress);
                
                const video = document.getElementById('viewmon-video');
                if (video) {
                    video.src = GIT_Module_Data.video_url;
                    document.getElementById('feedback-message').textContent = "AWAITING MEDIA METADATA";
                    
                    video.addEventListener('loadedmetadata', () => {
                        GIT_Module_Data.video_duration_sec = video.duration; 
                        
                        syncSupportLayers();
                        playButton.disabled = false; 
                        document.getElementById('feedback-message').textContent = "Ready. Press ▶ to start.";
                    });

                    video.addEventListener('timeupdate', syncSupportLayers);
                }
                
                syncSupportLayers(); 
            });
            // VROOGLY: END OF IE REGULATOR CORE LOGIC
        </script>
    </body>
</html>
