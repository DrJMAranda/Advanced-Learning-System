<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>SEA~ALS</title>
        <style>
            /* --- CSS: ORDEN GLOBAL Y MAPA ESTRUCTURAL --- */
            
            body { margin: 0; padding: 0; background-color: #f4f4f9; font-size: 16px; }
            
            /* --- FLEXBOX EXTERNO (El Contenedor Principal) --- */
            .outer-flexbox { 
                /* 6. ORDEN: Usa Flexbox para centrar toda la estructura en la página. */
                display: flex; justify-content: center; align-items: flex-start; 
                min-height: 100vh; width: 100vw; overflow: hidden; 
            }

            /* --- GRID INTERNO (El Mapa Topográfico de la Página) --- */
            .inner-grid-container {
                /* 7. LA CUADRÍCULA: Define 5 columnas de igual ancho (1fr) y filas ponderadas. */
                display: grid;
                grid-template-columns: repeat(5, 1fr); 
                grid-template-rows: 0.2fr 1.8fr 1.8fr 0.6fr 0.6fr; /* Filas ponderadas para la jerarquía visual */
                width: 100%;
                max-width: 1200px; /* Límite de ancho para estabilidad en pantallas grandes */
                height: 100vh; 
            }

            /* --- VIEWMON BLOCK (El Holón Central) --- */
            .viewmon-container {
                /* 8. POSICIONAMIENTO EN EL MAPA: Ocupa las 5 columnas y las filas 2 y 3. */
                grid-column: 1 / span 5;
                grid-row: 2 / span 2; 
                background-color: #000;
                display: grid; 
                
                /* 9. EL STACK INTERNO: Define 6 filas internas para organizar el contenido multimedia y de texto. */
                grid-template-columns: 1fr;
                grid-template-rows: 
                    0.10fr /* 1. Controls Bar (Controles) */
                    3fr    /* 2. VidMon Display (El video, la parte más grande) */
                    0.2fr  /* 3. Accent Bar (El contenido de acento/feedback) */
                    0.3fr  /* 4. Image Bar */
                    0.3fr; /* 5. Music Staff */
                
                /* 10. ESTABILIDAD ASIMÉTRICA: Garantiza que el video siempre tenga una proporción 16:9, evitando distorsiones. */
                aspect-ratio: 16 / 9;
                width: 90%;
                margin: 0 auto;
                position: relative;
            }
            
            /* --- 1. CONTROLS BAR --- */
            .controls-row {
                grid-row: 1;
                /* 11. ORDEN INTERNO: Usa Flexbox para distribuir los botones de control uniformemente. */
                display: flex;
                justify-content: space-around;
                align-items: center;
                /* ... otros estilos ... */
            }
            .control-btn {
                /* 12. EFICIENCIA: Asegura que el contenido del botón (el símbolo) esté centrado. */
                display: flex; 
                justify-content: center; /* Simplificación: 'center-content' no es estándar; justify/align lo hacen. */
                align-items: center;
                /* ... otros estilos ... */
            }
            
            /* --- 2. VIDMON DISPLAY (Contenido Principal) --- */
            .vidmon-display {
                grid-row: 2;
                background-color: black;
                position: relative;
            }
            .vidmon-display video { 
                /* 13. ADAPTABILIDAD AL CONTENEDOR: El video se ajusta al 100% de su espacio. */
                width: 100%; height: 100%; object-fit: contain; 
            }

            /* --- 3. TEXT SCROLLBAR (El Log de Énfasis) --- */
            /* Se eliminó la clase 'text-scrollbar' redundante. */
            .text-scrollbar-accent {
                grid-row: 3;
                background-color: #333;
                color: white;
                overflow-y: auto; 
                font-family: 'Courier New', monospace;
                /* 14. LIMITACIÓN CONTROLADA: Fija la altura máxima a 3 líneas de texto, cumpliendo tu regla de orden y control. */
                max-height: calc(14pt * 1.5 * 3); 
                /* ... otros estilos ... */
            }

            /* --- Q&A Overlay (Capa de Conciencia) --- */
            .qa-overlay {
                /* 15. POSICIÓN FIJA/CENTRAL: Aparece flotando sobre el video (position: fixed) y centrado. */
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                z-index: 1000; /* Asegura que siempre esté encima de todos los demás elementos. */
                display: none; /* Inicialmente no visible. */
                /* ... otros estilos ... */
            }
        </style>
    </head>
    <body>
        <div class="qa-overlay">
            <h2>Acknowledgment Required</h2>
            <p id="qa-question-display">Question: [Loading...]</p>
            <p id="qa-solution-display" style="font-weight: bold;">Solution: [Loading...]</p>
            <button onclick="handleOverlayConfirm()">Acknowledge / Confirm</button>
        </div>

        <div class="outer-flexbox">
            <div class="inner-grid-container">
                
                <div class="metadata-row">
                    <div class="metadata-item id-registro">ID: G-1001</div>
                    <div class="metadata-item id-relacional">REL: M-45</div>
                </div>

                <div class="viewmon-container">
                    <div class="controls-row">
                        <button data-control="5" data-qa-role="3" class="control-btn" title="Fast Forward/End">⏭</button>
                        <button data-control="2" data-qa-role="0" class="control-btn" title="Restart/A">|◀</button>
                        <button data-control="3" data-qa-role="1" class="control-btn" title="Rewind/B">⏪</button>
                        <button data-control="4" data-qa-role="2" class="control-btn" title="Play/Acknowledge">▶</button>
                        <button data-control="1" data-qa-role="esc" class="control-btn" title="Exit/Eject">↩</button>
                    </div>

                    <div class="vidmon-display">
                        <video id="viewmon-video" controlsList="nodownload" disablepictureinpicture src="http://your.video.source/default.mp4" autoplay muted></video>
                        <div class="teachermon-cameo"></div>
                    </div>
    
                    <div class="text-scrollbar-accent">
                        <div class="accent-line" id="ccd-emphasis">- - ' - - '</div> 
                        <p id="accent-content">This is the accent area, restricted to 20 mono-spaced chars wide by 1 lines max.</p>
                    </div>
                    
                    <div class="image-bar" id="image-flow-slot">Image Flow (Visual Dictionary)</div>
                    
                    <div class="music-staff-bar">Music Staff Notation Zone</div>

                </div>
                
                <div class="bottom-zone" style="display:flex; justify-content:space-between; padding: 10px;">
                    <div class="student-dashboard">... Dashboard Content ...</div>
                    <div class="ttm-output" id="ttm-output">L1: VID 00:00/05:00 PENDING | L2: ARIT INTENTOS 0 PUNT 0.00</div>
                    <div class="action-status-zone"><p id="feedback-message">Ready.</p></div>
                </div>
            </div>
        </div>
        
        <script>
            // --- JAVASCRIPT: LA ENTIDAD INTELIGENTE (IE) ---
            
            // 24. ESQUEMA DE DATOS (SINGLE SOURCE OF TRUTH):
            // La fuente única de verdad. Define las variables clave para el módulo.
            const GIT_Module_Data = {
                video_url: "http://your.video.source/default.mp4",
                video_duration_sec: 300, 
                ttm_initial_status: "PENDING", 
                tasks: [
                    // Tareas: el desafío del cáliz para el estudiante.
                    { id: 1, question: "Is 2x + 5 = 15 solved by x=5?", solution: "True", input_map: '4' },
                    { id: 2, question: "What is the perfect dx/dy angle?", solution: "B", input_map: '2' },
                    { id: 3, question: "Does dx/dy represent a controlled slide?", solution: "False", input_map: '3' }
                ],
                image_flow_items: [
                    // El flujo de imágenes/conceptos que se activa por tiempo.
                    { text: "Controlled Glide", trigger_time_sec: 10 },
                    { text: "Blue Bird", trigger_time_sec: 25 }
                ]
            };

            // 25. ESTADO GLOBAL: Las variables de control que cambian durante la ejecución del programa.
            let state = {
                isQuizActive: false, // ¿Está el sistema en modo "Cáliz/Decisión"?
                currentTaskIndex: 0,
                attemptsCount: 0,
                score: 0.0,
                videoTimeFrozen: 0 
            };
            
            // --- FASE 2: LÓGICA DE SINCRONIZACIÓN (El Plan de Vuelo Lógico) ---
            
            const formatTime = (seconds) => new Date(seconds * 1000).toISOString().substr(14, 5);

            const syncSupportLayers = () => {
                const video = document.getElementById('viewmon-video');
                if (!video || state.isQuizActive) return; 

                const currentTime = video.currentTime;
                const duration = GIT_Module_Data.video_duration_sec;
                
                // 1. TTM Update
                // ... (Logic to update the Time-to-Mastery text) ...

                // 2. Image Flow Trigger (COMBOCULACIÓN: Verificación de Estado Persistente)
                // Esto cierra el "agujero" del tiempo al revisar el historial.
                const itemsToShow = GIT_Module_Data.image_flow_items.filter(item => item.trigger_time_sec <= currentTime);

                if (itemsToShow.length > 0) {
                    // Muestra el último evento que debería haberse activado (incluso si el video saltó)
                    const latestItem = itemsToShow[itemsToShow.length - 1]; 
                    document.getElementById('image-flow-slot').textContent = `IMAGE FLOW: ${latestItem.text}`;
                }
                
                // 3. Q&A Auto-Trigger (Placeholder for future logic)
            };
            
            // --- FASE 1: LÓGICA DE ACCIÓN Y CONTROL ---

            const handleOverlayConfirm = () => {
                // 26. RESUELVE EL CÁLIZ: Actualiza el estado al confirmar la respuesta.
                state.attemptsCount++;
                state.score = 1.0; 
                
                // ... (Logic to update UI and close overlay) ...
            };

            const handleControlClick = (event) => {
                const controlNumber = event.currentTarget.dataset.control;
                const video = document.getElementById('viewmon-video');

                if (state.isQuizActive) {
                    // 27. REGLA DE ORDEN: Ignora todos los botones si el quiz (el Cáliz) está activo.
                    return; 
                }
                
                if (controlNumber === '4') { // ACCIÓN PRIMARIA: Jugar/Pausar/Reconocer
                    // Lógica para alternar la reproducción o ejecutar la progresión.
                    if (state.score === 1.0) {
                        handleNextProgression(); // La progresión solo se ejecuta si se reconoce (score = 1.0).
                    } else if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                } else if (controlNumber === '3') { // REBOBINAR (ACCION ÚNICA)
                    // 28. SIMPLIFICACIÓN: El botón solo debe hacer una cosa (rebobinar), eliminando el código de prueba.
                    video.currentTime = Math.max(0, video.currentTime - 10); 
                } else {
                    // ... (Other controls) ...
                }
            };

            const handleNextProgression = () => {
                // 29. LÓGICA DE PROGRESIÓN CONTROLADA: Avanza al siguiente 'holón' de la tarea.
                const total = GIT_Module_Data.tasks.length;
                
                if (state.currentTaskIndex < total - 1) {
                    // [Micro-Progression: Siguiente Tarea]
                    state.currentTaskIndex++;
                    state.score = 0.0; // Restablecer el score: el estudiante debe reconocer el nuevo Holón.
                    document.querySelector('[data-control="4"]').disabled = true; // Deshabilitar hasta el nuevo reconocimiento
                } else if (state.currentTaskIndex === total - 1) {
                    // [Macro-Progression: Final del Módulo]
                    console.log("Macro-Progression: Module sequence complete. Triggering global router.");
                }
                // ... (Update UI) ...
            };

            const triggerAcknowledgment = () => {
                // 30. ACTIVACIÓN DEL CÁLIZ: Pausa el video y muestra la ventana de la pregunta.
                state.isQuizActive = true;
                document.getElementById('viewmon-video').pause(); 
                // ... (Display question and solution) ...
            };

            // --- INICIALIZACIÓN ---
            document.addEventListener('DOMContentLoaded', () => {
                // 31. BUCLE DE CONTROL: Se ejecuta una vez que el documento está cargado.
                
                // Conecta todos los botones al controlador principal.
                document.querySelectorAll('.control-btn').forEach(button => {
                    button.addEventListener('click', handleControlClick);
                });

                // Establece el estado inicial: La progresión está deshabilitada (el Cáliz está cerrado).
                document.querySelector('[data-control="4"]').disabled = true;
                
                // 32. VINCULACIÓN DE TIEMPO: Conecta la función de sincronización (syncSupportLayers) al evento de tiempo del video.
                const video = document.getElementById('viewmon-video');
                if (video) {
                    video.addEventListener('timeupdate', syncSupportLayers);
                }
            });
            // ... (Faltan algunas funciones auxiliares como updateTTM y showFeedback) ...
        </script>
    </body>
</html>
