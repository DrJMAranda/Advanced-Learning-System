<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Learning System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
        :root {
            --color-lighthouse: #f4f4f4; --color-stealth: #d3d3d3; --color-accent-active: #ffdd88;
            --color-control: #444; --bevel-shadow-light: rgba(255, 255, 255, 0.7);
            --bevel-shadow-dark: rgba(0, 0, 0, 0.3); --color-lps-kps: #EFEFEF;
        }
        .beveled-frame { box-shadow: inset 1px 1px 3px var(--bevel-shadow-light), inset -1px -1px 3px var(--bevel-shadow-dark); border: 1px solid var(--color-stealth); }
        body { margin: 0; font-family: 'EB Garamond', serif; height: 100vh; display: flex; background: var(--color-lighthouse); color: black; overflow: hidden; }
        #left-menu { width: 275px; background: var(--color-lighthouse); color: black; padding: 10px; flex-shrink: 0; height: 100vh; position: relative; padding-bottom: 70px; overflow-y: auto; }
        #credits { text-align: center; }
        #menu-list-container { margin-top: 10px; text-align: left; padding: 5px; border: 1px dashed #0070C0; }
        #menu-list-content { font-size: 9pt; line-height: 1.3; font-weight: 400; color: black; white-space: pre-line; }
        #student-id-box { position: absolute; bottom: 30px; left: 0; width: 100%; padding: 5px 10px; box-sizing: border-box; background: #fff; border-top: 1px solid #ccc; font-family: 'Roboto Mono', monospace; font-size: 8pt; color: #333; z-index: 99; }
        #date-stamp-tn-fixed { position: absolute; bottom: 0px; left: 0px; padding: 5px 10px; font-size: 7pt; color: #555; font-family: monospace; z-index: 100; background: var(--color-lighthouse); width: 100%; box-sizing: border-box; text-align: left; }
        #content-wrapper { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        #scrolling-icon-bar { width: 100%; display: flex; flex-wrap: nowrap; gap: 10px; padding: 10px; overflow-x: auto; flex-shrink: 0; background: var(--color-stealth); box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-height: 80px; box-sizing: border-box; }
        .icon-button { flex-shrink: 0; width: 100px; text-align: center; border: 1px solid #999; background: #fff; padding: 5px; cursor: pointer; box-shadow: 2px 2px 5px rgba(0,0,0,0.2); font-family: 'Roboto Mono', monospace; font-size: 0.8em; }
        .icon-button img { max-width: 100%; height: auto; display: block; }
        .icon-title { display: block; margin-top: 5px; }
        #main-content { flex-grow: 1; padding: 20px; background: var(--color-lighthouse); overflow-y: auto; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
        #lps-monitor-simulacrum { width: 90%; max-width: 1000px; display: flex; flex-direction: column; align-items: center; }
        #lps-header-strip { width: 100%; background: var(--color-control); color: var(--color-lighthouse); padding: 5px 10px; box-sizing: border-box; font-family: 'Roboto Mono', monospace; font-size: 10pt; text-align: left; border-top-left-radius: 5px; border-top-right-radius: 5px; }
        #video-display-monitor { width: 100%; padding-bottom: 56.25%; position: relative; background-color: black; border: 2px solid #555; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        #video-player-secure { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; background-color: black; color: white; background-image: url('https://storage.googleapis.com/noenbalde/Backgrounds/Bucolic-Panorama-Placeholder.jpg'); background-size: cover; background-position: center; }
        #initial-message-overlay { background-color: rgba(0, 0, 0, 0.4); padding: 20px 40px; border-radius: 5px; }
        #lps-control-bar { width: 100%; background: var(--color-control); padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #777; box-sizing: border-box; font-family: 'Roboto Mono', border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; }
        #lps-control-bar button { background: #fff; border: 1px solid #333; padding: 5px 10px; font-size: 1.1em; cursor: pointer; }
        
        /* Styles for P1 Vocabulary */
        #flashcard-container { width: 100%; max-width: 500px; height: 100%; background: white; border: 2px solid #ccc; border-radius: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; text-align: center; }
        #flashcard-image { max-width: 80%; max-height: 60%; object-fit: contain; }
        #flashcard-text { margin-top: 20px; }
        #flashcard-text p { font-size: 1.5em; margin: 5px 0; }
        .hidden { display: none; }

        /* Styles for P2 Numerals */
        #numeral-game-container { width: 100%; height: 100%; background: white; padding: 20px; box-sizing: border-box; text-align: center; }
        #target-number { font-size: 3em; color: #333; }
        #choice-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px; }
        .choice-card { background: #f0f0f0; border: 5px solid transparent; border-radius: 10px; padding: 10px; cursor: pointer; transition: transform 0.2s; }
        .choice-card:hover { transform: scale(1.05); }
        .choice-card img { width: 100%; max-height: 100px; object-fit: contain; }
    </style>
</head>
<body>
    <nav id="left-menu" class="beveled-frame">
        <div id="credits">
            <h3>Welcome to the<br>Advanced Learning System</h3>
            <h4>Powered by ARAGEM!</h4>
        </div>
        <div id="menu-list-container">
            <div id="menu-list-content">
                <div id="numeral-header" style="font-weight: bold; margin-bottom: 5px; color: #0070C0;">1. Elementary Level</div>
                <div id="numeral-content" style="padding-left: 15px; display: block;">
                    A1 Arithmetic
                    01 Numerals 0-4 (AP1U1S2)
                    02 Numerals 5-9 (AP1U1S3)
                    03 Numerals to |Ninety-Nine| (AP1U2)
                    04 Numerals to |Decillions| (AP1U3)
                    05 Addition Principles
                    B1 Language
                    01 Vocabulary
                    02 Grammar
                </div>
            </div>
        </div>
        <div id="student-id-box"></div>
        <div id="date-stamp-tn-fixed"></div>
    </nav>
    <div id="content-wrapper">
        <header id="scrolling-icon-bar" class="beveled-frame">
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/AP1U1S1%20Meet%20The%20Digits.mp4', 'AP1U1S1: The Journey Begins...', 'AP1U1S1')"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/The%20Journey%20Begins.jpg" alt="AP1U1S1"><span class="icon-title">AP1U1S1</span></button>
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/04%20AP1U1S2%20Counting%20through%20Four.mp4', 'AP1U1S2: Mr. Zero!', 'AP1U1S2')"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/Mr.%20Zero%2C%20The%20First%20Something.jpg" alt="AP1U1S2"><span class="icon-title">AP1U1S2</span></button>
            <button class="icon-button beveled-frame" onclick="playModule('https://storage.googleapis.com/noenbalde/Giddyap/AP1U1S3T5-9%20250928%202023.mp4', 'AP1U1S3: The Numeral Family', 'AP1U1S3')"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/The%20Numeral%20Family.jpg" alt="AP1U1S3"><span class="icon-title">AP1U1S3</span></button>
            
            <button class="icon-button beveled-frame" onclick="startVocabularyPractice()"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/VOCAB-Placeholder.jpg" alt="Practice 1"><span class="icon-title">P1</span></button>
            <button class="icon-button beveled-frame" onclick="startNumeralPractice()"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/NUMERALS-Placeholder.jpg" alt="Practice 2"><span class="icon-title">P2</span></button>
            
            <button class="icon-button beveled-frame" onclick="comingSoon()"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/AP1U2-Placeholder.jpg" alt="AP1U2"><span class="icon-title">U2</span></button>
            <button class="icon-button beveled-frame" onclick="comingSoon()"><img src="https://storage.googleapis.com/noenbalde/Car%C3%A1tulas/AP1U3-Placeholder.jpg" alt="AP1U3"><span class="icon-title">U3</span></button>
        </header>
        <section id="main-content">
            <div id="lps-monitor-simulacrum">
                <div id="lps-header-strip">Select a Unit to Begin</div>
                <div id="video-display-monitor">
                    <div id="video-player-secure"></div>
                </div>
                <div id="lps-control-bar">
                    <button onclick="closeVideo()">X Close</button>
                </div>
            </div>
        </section>
    </div>

<script>
    const videoPlayerSecure = document.getElementById('video-player-secure');
    const lpsHeaderStrip = document.getElementById('lps-header-strip');
    const originalControlBarHTML = `<button onclick="closeVideo()">X Close</button>`;

    const initialContentHTML = `
        <div id="initial-message-overlay">
            <h2 style="color: white; font-size: 2em;">Select a Unit from The Star Chart.</h2>
            <p style="color: white; font-size: 1.1em;">The Force will guide your learning journey.</p>
        </div>
    `;
    
    // --- CORE VIDEO PLAYER FUNCTIONS ---
    function playModule(videoSource, moduleTitle, idnKey) {
        if (!videoSource) { return; }
        lpsHeaderStrip.textContent = `Now Playing: ${moduleTitle} (${idnKey})`;
        videoPlayerSecure.innerHTML = `
            <video controls autoplay controlslist="nodownload" style="width: 100%; height: 100%; object-fit: cover;">
                <source src="${videoSource}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        `;
    }
    function showInitialMessage() {
        lpsHeaderStrip.textContent = `Select a Unit to Begin`;
        videoPlayerSecure.innerHTML = initialContentHTML;
    }
    function closeVideo() { showInitialMessage(); }

    // --- DATA & FUNCTIONS FOR P1 (VOCABULARY) ---
    let liveVocabularyData = [];
    let currentCardIndex = 0;
    
    async function loadVocabularyData() {
        const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTXQL0l60-fHFaJl_6IVl7aqglBbzkjTKhhXwR4uFEgHcQ7sh-4ERD_a3dS7U2f_RMZqxp4LvnoUIh0/pub?output=csv';
        // --- FIX for GooeySec (CORS Policy) ---
        const proxyURL = `https://api.allorigins.win/raw?url=${encodeURIComponent(sheetURL)}`;
        try {
            const response = await fetch(proxyURL);
            const csvText = await response.text();
            liveVocabularyData = csvText.trim().split('\n').slice(1).map(row => {
                const columns = row.split(',');
                return { spanish: columns[0], english: columns[1], image: columns[2] };
            });
            console.log("Vocabulary data loaded successfully via proxy!");
        } catch (error) { console.error("Failed to load vocabulary data:", error); }
    }
    
    function startVocabularyPractice() {
        if (liveVocabularyData.length === 0) { 
            alert('Vocabulary data is still loading. Please try again in a moment.'); 
            return; 
        }
        lpsHeaderStrip.textContent = `Practice 1: Vocabulary`;
        videoPlayerSecure.innerHTML = `<div id="flashcard-container"><img id="flashcard-image" src="" alt="Vocabulary Image"><div id="flashcard-text" class="hidden"><p id="flashcard-spanish"></p><p id="flashcard-english"></p></div></div>`;
        document.querySelector('#lps-control-bar').innerHTML = `<button onclick="flipCard()">Flip Card</button><button onclick="nextCard()">Next</button><button onclick="closeExercise()">X Close</button>`;
        currentCardIndex = 0;
        showCard(currentCardIndex);
    }
    function showCard(index) {
        const card = liveVocabularyData[index];
        document.getElementById('flashcard-image').src = card.image;
        document.getElementById('flashcard-spanish').textContent = `Español: ${card.spanish}`;
        document.getElementById('flashcard-english').textContent = `English: ${card.english}`;
        document.getElementById('flashcard-text').classList.add('hidden');
    }
    function flipCard() { document.getElementById('flashcard-text').classList.toggle('hidden'); }
    function nextCard() {
        currentCardIndex = (currentCardIndex + 1) % liveVocabularyData.length;
        showCard(currentCardIndex);
    }

    // --- DATA & FUNCTIONS FOR P2 (NUMERALS) ---
    let liveNumeralData = [];

    async function loadNumeralData() {
        const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS2WHG3VJ5-tlFHMnX25Z47AsFx6eU93xbewqzfDb2hYtzKm9-bdDl0jr43qeLptcR-p_fEdn0GXI9p/pub?output=csv';
        // --- FIX for GooeySec (CORS Policy) ---
        const proxyURL = `https://api.allorigins.win/raw?url=${encodeURIComponent(sheetURL)}`;
        try {
            const response = await fetch(proxyURL);
            const csvText = await response.text();
            liveNumeralData = csvText.trim().split('\n').slice(1).map(row => {
                const columns = row.split(',');
                return { value: parseInt(columns[0]), type: columns[1], image: columns[2] };
            });
            console.log("Numeral data loaded successfully via proxy!");
        } catch (error) { console.error("Failed to load numeral data:", error); }
    }

    function startNumeralPractice() {
        if (liveNumeralData.length === 0) { 
            alert('Numeral data is still loading. Please try again in a moment!'); 
            return; 
        }
        lpsHeaderStrip.textContent = `Practice 2: Numeral Recognition`;
        videoPlayerSecure.innerHTML = `<div id="numeral-game-container"><h2 id="target-number"></h2><div id="choice-grid"></div></div>`;
        // --- UI TWEAK: "New Match" button text ---
        document.querySelector('#lps-control-bar').innerHTML = `<button onclick="generatePuzzle()">New Match</button><button onclick="closeExercise()">X Close</button>`;
        generatePuzzle();
    }
    
    function generatePuzzle() {
        if (liveNumeralData.length === 0) {
            console.log("Waiting for numeral data to load...");
            return; 
        }
        
        const choiceGrid = document.getElementById('choice-grid');
        choiceGrid.innerHTML = ''; 
        const targetNumber = Math.floor(Math.random() * 10); 
        
        // --- UI TWEAK: "Match: [number]" prompt text ---
        document.getElementById('target-number').textContent = `Match: ${targetNumber}`;
        
        const correctOptions = liveNumeralData.filter(item => item.value === targetNumber);
        
        if (correctOptions.length === 0) { 
            console.error(`No images found for target: ${targetNumber}. Retrying...`); 
            setTimeout(generatePuzzle, 100); 
            return; 
        }
        
        const correctAnswer = correctOptions[Math.floor(Math.random() * correctOptions.length)];
        const incorrectOptions = liveNumeralData.filter(item => item.value !== targetNumber);
        let wrongAnswers = [];
        
        for (let i = 0; i < 3; i++) {
            wrongAnswers.push(incorrectOptions[Math.floor(Math.random() * incorrectOptions.length)]);
        }
        
        const choices = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
        
        choices.forEach(choice => {
            const choiceElement = document.createElement('div');
            choiceElement.classList.add('choice-card');
            choiceElement.innerHTML = `<img src="${choice.image}" alt="Number ${choice.value}">`;
            choiceElement.onclick = () => checkAnswer(choice.value, targetValue, choiceElement);
            choiceGrid.appendChild(choiceElement);
        });
    }
    
    function checkAnswer(selectedValue, targetValue, element) {
        document.querySelectorAll('.choice-card').forEach(card => card.onclick = null);
        element.style.border = selectedValue === targetValue ? '5px solid green' : '5px solid red';
        setTimeout(generatePuzzle, 1500);
    }
    
    // --- UTILITY FUNCTIONS ---
    function closeExercise() {
        document.querySelector('#lps-control-bar').innerHTML = originalControlBarHTML;
        showInitialMessage();
    }
    function updateDateStamp() {
        const now = new Date();
        const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', timeZone: 'America/Chicago', hour12: false };
        document.getElementById('date-stamp-tn-fixed').textContent = `TN Time: ${now.toLocaleString('en-US', options)}`;
    }
    function comingSoon() { alert("This module is 'under construction' and will be available shortly!"); }

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        showInitialMessage();
        updateDateStamp();
        setInterval(updateDateStamp, 60000);
        document.getElementById('student-id-box').innerHTML = `**Student ID:** 900213<br>**Descriptors:** [ALGEBRAIC: C]`;
        
        // Load the live data from spreadsheets as soon as the page is ready
        loadVocabularyData();
        loadNumeralData();
    });
</script>
</body>
</html>
